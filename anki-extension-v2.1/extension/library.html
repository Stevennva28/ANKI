<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anki Vocabulary Library</title>
  <link rel="stylesheet" href="styles/library.css">
</head>
<body>
  <header class="library-header">
    <div class="container">
      <h1>üìö Vocabulary Library</h1>
      <p class="tagline">Manage your vocabulary learning journey</p>
    </div>
  </header>

  <div class="container">
    <nav class="tabs">
      <button class="tab active" data-tab="queue">
        <span class="tab-icon">üìù</span>
        <span>Queue</span>
      </button>
      <button class="tab" data-tab="history">
        <span class="tab-icon">üìñ</span>
        <span>History</span>
      </button>
      <button class="tab" data-tab="analytics">
        <span class="tab-icon">üìä</span>
        <span>Analytics</span>
      </button>
      <button class="tab" data-tab="settings">
        <span class="tab-icon">‚öôÔ∏è</span>
        <span>Settings</span>
      </button>
    </nav>

    <!-- QUEUE TAB -->
    <div id="queue" class="tab-content active">
      <div class="section-header">
        <h2>Words Queue</h2>
        <div class="section-actions">
          <button class="btn btn-primary" id="enrichAllQueueBtn">‚ö° Enrich All</button>
          <button class="btn btn-success" id="addAllQueueBtn">‚úÖ Add All to Anki</button>
        </div>
      </div>
      <div id="queueContent" class="content-area">
        <div class="loading">Loading queue...</div>
      </div>
    </div>

    <!-- HISTORY TAB -->
    <div id="history" class="tab-content">
      <div class="section-header">
        <h2>Learning History</h2>
        <div class="section-actions">
          <button class="btn btn-secondary" id="exportHistoryBtn">üì§ Export</button>
          <input type="search" id="historySearch" placeholder="Search history..." class="search-input">
        </div>
      </div>
      <div id="historyContent" class="content-area">
        <div class="loading">Loading history...</div>
      </div>
    </div>

    <!-- ANALYTICS TAB -->
    <div id="analytics" class="tab-content">
      <div class="section-header">
        <h2>Learning Analytics</h2>
      </div>
      <div id="statsGrid" class="stats-grid">
        <div class="loading">Loading statistics...</div>
      </div>
    </div>

    <!-- SETTINGS TAB -->
    <div id="settings" class="tab-content">
      <div class="section-header">
        <h2>Settings</h2>
      </div>

      <div class="settings-sections">

        <!-- API CONFIGURATION -->
        <section class="settings-section">
          <h3>üîë API Configuration</h3>
          <p class="section-description">Configure API keys for premium dictionaries and audio sources</p>

          <div class="settings-grid">
            <div class="setting-item">
              <label for="oxfordAppId">Oxford App ID</label>
              <input type="text" id="oxfordAppId" placeholder="Enter your Oxford App ID" class="input">
              <small class="hint">Get API keys at <a href="https://developer.oxforddictionaries.com/" target="_blank">Oxford Dictionaries API</a></small>
            </div>

            <div class="setting-item">
              <label for="oxfordAppKey">Oxford App Key</label>
              <input type="password" id="oxfordAppKey" placeholder="Enter your Oxford App Key" class="input">
            </div>

            <div class="setting-item">
              <label for="forvoApiKey">Forvo API Key (Optional)</label>
              <input type="password" id="forvoApiKey" placeholder="Enter your Forvo API Key" class="input">
              <small class="hint">For native speaker pronunciations from <a href="https://www.forvo.com/api/" target="_blank">Forvo</a></small>
            </div>
          </div>
        </section>

        <!-- ANKI CONFIGURATION (FIELD MAPPING!) -->
        <section class="settings-section" id="ankiConfigSection">
          <h3>üé¥ Anki Configuration</h3>
          <p class="section-description">Configure Anki deck and note type with custom field mapping</p>

          <div class="settings-grid">
            <div class="setting-item">
              <label for="defaultDeck">Default Deck</label>
              <select id="defaultDeck" class="select">
                <option value="">Loading decks...</option>
              </select>
            </div>

            <div class="setting-item">
              <label for="noteType">Note Type</label>
              <div class="input-with-button">
                <select id="noteType" class="select">
                  <option value="">-- Select Note Type --</option>
                </select>
                <button type="button" id="refreshAnkiBtn" class="btn-icon" title="Refresh Anki data">
                  üîÑ
                </button>
              </div>
              <small class="hint">Select your Anki note type to configure field mapping</small>
            </div>
          </div>

          <!-- FIELD MAPPING TABLE -->
          <div id="fieldMappingContainer" class="field-mapping-container" style="display: none;">
            <div class="field-mapping-header">
              <h4>Field Mapping</h4>
              <p>Map your Anki note fields to vocabulary data from the extension</p>
            </div>

            <div class="table-container">
              <table class="field-mapping-table">
                <thead>
                  <tr>
                    <th>Anki Field</th>
                    <th></th>
                    <th>Extension Data</th>
                    <th>Preview</th>
                  </tr>
                </thead>
                <tbody id="fieldMappingBody">
                  <!-- Dynamically populated -->
                </tbody>
              </table>
            </div>

            <div class="field-mapping-actions">
              <button type="button" id="autoDetectBtn" class="btn btn-secondary">
                üîç Auto-Detect Fields
              </button>
              <button type="button" id="resetMappingBtn" class="btn btn-secondary">
                ‚Ü∫ Reset to Default
              </button>
              <button type="button" id="saveMappingBtn" class="btn btn-primary">
                üíæ Save Field Mapping
              </button>
            </div>

            <div class="field-mapping-help">
              <details>
                <summary>‚ÑπÔ∏è How does field mapping work?</summary>
                <div class="help-content">
                  <p><strong>Field Mapping</strong> allows you to use any Anki note type with this extension!</p>
                  <ol>
                    <li>Select your note type from the dropdown above</li>
                    <li>The table will show all fields in your note type</li>
                    <li>For each field, select which extension data to use</li>
                    <li>Click <strong>Auto-Detect</strong> for automatic matching by field names</li>
                    <li>Click <strong>Save</strong> to apply the mapping</li>
                  </ol>
                  <p><strong>Example:</strong> If your note type has a field called "Front", you can map it to "word" (English word)</p>
                </div>
              </details>
            </div>
          </div>
        </section>

        <!-- ENRICHMENT OPTIONS -->
        <section class="settings-section">
          <h3>‚ú® Enrichment Options</h3>
          <p class="section-description">Configure how words are enriched with definitions and audio</p>

          <div class="settings-grid">
            <div class="setting-item checkbox-item">
              <label>
                <input type="checkbox" id="autoEnrich">
                <span>Auto-enrich words when added to queue</span>
              </label>
              <small class="hint">Automatically fetch definitions and audio when you add a word</small>
            </div>
          </div>
        </section>

        <!-- UI PREFERENCES -->
        <section class="settings-section">
          <h3>üé® UI Preferences</h3>
          <p class="section-description">Customize the look and feel of the extension</p>

          <div class="settings-grid">
            <div class="setting-item checkbox-item">
              <label>
                <input type="checkbox" id="darkMode">
                <span>Dark Mode</span>
              </label>
              <small class="hint">Enable dark theme for the extension</small>
            </div>

            <div class="setting-item checkbox-item">
              <label>
                <input type="checkbox" id="showNotifications">
                <span>Show notifications</span>
              </label>
              <small class="hint">Get notified when words are added to Anki</small>
            </div>
          </div>
        </section>

        <!-- DATA MANAGEMENT -->
        <section class="settings-section">
          <h3>üíæ Data Management</h3>
          <p class="section-description">Import, export, or clear your vocabulary data</p>

          <div class="data-actions">
            <button type="button" id="exportDataBtn" class="btn btn-secondary">
              üì§ Export All Data
            </button>
            <button type="button" id="importDataBtn" class="btn btn-secondary">
              üì• Import Data
            </button>
            <button type="button" id="clearCacheBtn" class="btn btn-warning">
              üóëÔ∏è Clear Cache
            </button>
          </div>
        </section>

        <!-- SAVE SETTINGS BUTTON -->
        <div class="settings-actions">
          <button type="button" id="saveSettingsBtn" class="btn btn-primary btn-lg">
            üíæ Save All Settings
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Scripts -->
  <script type="module" src="utils/constants.js"></script>
  <script type="module" src="utils/helpers.js"></script>
  <script type="module" src="utils/storage-manager.js"></script>
  <script type="module" src="library.js"></script>
</body>
</html>
